name: News Collection Workflow

on:
  # 每天上午6点自动触发（使用UTC时间，北京时间上午6点 = UTC时间前一天晚上10点）
  schedule:
    - cron: '0 22 * * *'
    - cron: '0 6 * * *'  # UTC时间上午6点（北京时间下午2点）

  # 允许手动触发
  workflow_dispatch:
    inputs:
      emails:
        description: '接收邮件的邮箱地址（多个用逗号分隔）'
        required: true
        default: 'your-email@example.com'

jobs:
  collect-news:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run news collection workflow
        env:
          # 从环境变量或手动输入获取邮箱地址
          EMAILS: ${{ github.event.inputs.emails || secrets.EMAILS }}
          # 其他必要的环境变量
          COZE_WORKSPACE_PATH: ${{ github.workspace }}
        run: |
          # 如果没有提供邮箱地址，使用默认值
          if [ -z "$EMAILS" ]; then
            echo "错误：请设置 EMAILS 环境变量或在手动触发时提供邮箱地址"
            exit 1
          fi
          
          echo "开始收集新闻，发送到: $EMAILS"
          
          # 运行主程序
          python src/main.py --emails "$EMAILS"
      
      - name: Upload logs (if exists)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: workflow-logs
          path: |
            logs/*.log
          retention-days: 30
